<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .inputSearchList {
            display: none;
            width: 200px;
            height: auto;
            border: solid 1px black
        }

        .list-container {
            display: flex;
            flex-direction: column;
        }

        .previous-search-container {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            box-sizing: border-box;
            padding: 3px;
        }

        .delete-search {
            text-align: right;
            font-size: 15px;
            color: black;
            font-weight: bold;
            display: none;

        }
    </style>
</head>

<body>
    <input class="inputData" onclick="showLastSearches()">
    <div class="inputSearchList"></div>

    <script>
        document.addEventListener('click', function hideLastSearches(event) {
            const inputDiv = document.querySelector(".inputSearchList");
            const inputField = document.querySelector(".inputData");
            if (!inputDiv.contains(event.target) && !inputField.contains(event.target)) {
                inputDiv.replaceChildren();
                inputDiv.style.display = "none";
            }
        })

        function showLastSearches() {
            let lastSearches = JSON.parse(localStorage.getItem('storageArray'));
            let inputDiv = document.querySelector(".inputSearchList");
            let list = document.createElement('div');
            list.className = "list-container";
            inputDiv.replaceChildren(list);
            for (let i = 0; i < lastSearches.length; i++) {
                let previousSearchContainer = list.appendChild(document.createElement('div'));
                previousSearchContainer.className = "previous-search-container";
                let searchText = previousSearchContainer.appendChild(document.createElement('div'));
                searchText.className = "search-text";
                searchText.textContent = `${lastSearches[i]}`;
                searchText.addEventListener('click', function () {
                    document.querySelector(".inputData").value = event.target.textContent;
                    list.style.display = "none";
                })
                previousSearchContainer.addEventListener('click', function (event) {
                    if (!event.target.contains('delete-search')) {
                        document.querySelector(".inputData").value = searchText.textContent;
                        list.style.display = "none";
                    }
                })
                //создание div с крестиком
                let deleteSearch = previousSearchContainer.appendChild(document.createElement('div'));
                deleteSearch.className = "delete-search";
                deleteSearch.textContent = 'x';
                previousSearchContainer.onmouseover = previousSearchContainer.onmouseout = handler;
                function handler(event) {
                    if (event.type == "mouseover") {
                        event.target.style.background = "grey";
                        deleteSearch.style.display = "block";
                    }
                    if (event.type == "mouseout") {
                        event.target.style.background = "white";
                        deleteSearch.style.display = "none";
                    }
                }

                deleteSearch.addEventListener('click', function () {
                    previousSearchContainer.remove();
                    lastSearches.splice(i, 1);
                    localStorage.setItem('storageArray', JSON.stringify(lastSearches));
                })
            };


            inputDiv.style.display = "block";

        }


        function inputSearch() {
            let list = document.querySelector(".inputSearchList");
            list.style.display = "block";
            let inputData = document.querySelector(".inputData").value;
            //findWeatherData(inputData);
            let stored = localStorage.getItem('storageArray');
            let lastSearches;
            if (stored === null) {
                lastSearches = []
            } else {
                lastSearches = JSON.parse(stored);
            }
            if (lastSearches.length >= 10) {
                lastSearches.shift();
            }
            //arr.push => arr.unshift
            lastSearches.unshift(document.querySelector(".inputData").value);
            localStorage.setItem('storageArray', JSON.stringify(lastSearches));
        }

        function bindEnterKey() {
            document.querySelector(".inputData").addEventListener('keydown', function (enter) {
                if (enter.key === "Enter") {
                    inputSearch();
                    document.querySelector(".inputSearchList").style.display = "none";
                }
            });
        };
        bindEnterKey();



    </script>
</body>

</html>